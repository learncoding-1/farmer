<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Farmer App - Dashboard</title>
<style>
  body { font-family: Arial, sans-serif; background:#f5f5f5; margin:0; padding:0; }
  .container { max-width:1200px; margin:20px auto; padding:20px; }
  h1 { color:#b8860b; text-align:center; margin-bottom:30px; }

  #weatherCard { background:#fff8dc; border:2px solid #daa520; border-radius:15px; padding:20px; max-width:400px; margin:0 auto 30px; box-shadow:0 4px 12px rgba(0,0,0,0.2); text-align:center; }
  #weatherCard h3 { color:#b8860b; margin-bottom:10px; }
  #weatherCard p { margin:5px 0; }

  .stats { display:flex; justify-content:space-around; flex-wrap:wrap; gap:20px; margin-bottom:40px; }
  .stat-card { background:#fff8dc; border:2px solid #daa520; border-radius:15px; padding:20px; width:220px; text-align:center; box-shadow:0 4px 12px rgba(0,0,0,0.2); }
  .stat-card h3 { color:#b8860b; margin-bottom:10px; }
  .stat-card p { margin:5px 0; font-size:1rem; }

  #alerts { background:#fff; padding:20px; border-radius:15px; box-shadow:0 4px 12px rgba(0,0,0,0.2); margin-bottom:40px; }
  #alerts h2 { color:#b8860b; margin-bottom:10px; }
  #alerts ul { list-style:none; padding-left:0; }
  #alerts ul li { padding:8px 0; border-bottom:1px solid #ddd; }

  /* Finance Tracker */
  .finance-card {
    background:#fff8dc;
    border:2px solid #daa520;
    border-radius:15px;
    padding:20px;
    max-width:400px;
    margin:30px auto;
    box-shadow:0 6px 15px rgba(0,0,0,0.2);
  }
  .finance-card h2 {
    text-align:center; 
    color:#b8860b;
    margin-bottom:15px;
  }
  .input-group {
    display:flex; justify-content:space-between; align-items:center;
    margin-bottom:10px;
  }
  .input-group label {
    flex:1; color:#444; font-size:0.9rem;
  }
  .input-group input {
    flex:1; padding:6px; border:1px solid #ccc; border-radius:6px; text-align:right;
  }
  .result-box {
    margin-top:15px;
    padding:15px;
    background:#fff;
    border-radius:10px;
    text-align:center;
    font-size:0.95rem;
    box-shadow:inset 0 2px 6px rgba(0,0,0,0.1);
  }

  .nav-cards { display:flex; justify-content:space-evenly; flex-wrap:wrap; gap:20px; }
  .nav-card { background:#fff8dc; border:2px solid #daa520; border-radius:15px; padding:20px; width:200px; text-align:center; box-shadow:0 4px 12px rgba(0,0,0,0.2); cursor:pointer; transition: transform 0.3s, box-shadow 0.3s; }
  .nav-card:hover { transform:translateY(-5px); box-shadow:0 8px 20px rgba(0,0,0,0.3);}
  .nav-card h3 { color:#b8860b; margin-bottom:10px; }
  .nav-card p { font-size:0.9rem; }
</style>
</head>
<body>
<div class="container">
  <h1>Dashboard</h1>

  <div id="weatherCard">
    <h3>Weather in Your Farm</h3>
    <p id="weatherInfo">Loading...</p>
  </div>

  <div class="stats">
    <div class="stat-card"><h3>Soil Moisture</h3><p>65%</p></div>
    <div class="stat-card"><h3>Crop Health</h3><p>Good</p></div>
    <div class="stat-card"><h3>Irrigation Status</h3><p>Normal</p></div>
    <div class="stat-card"><h3>Fertilizer Schedule</h3><p>Next: 3 days</p></div>
  </div>

  <div id="alerts">
    <h2>Recent Alerts</h2>
    <ul>
      <li>üåßÔ∏è Rain expected tomorrow - Check irrigation system</li>
      <li>‚ö†Ô∏è High winds today - Secure equipment</li>
      <li>üíß Low soil moisture in Field A</li>
    </ul>
  </div>

  <!-- Expense & Yield Tracker -->
  <div class="finance-card">
    <h2>üìä Expense & Yield Tracker</h2>

    <div class="input-group">
      <label>Seeds (‚Çπ)</label>
      <input type="number" id="seeds" oninput="calculateFinance()">
    </div>

    <div class="input-group">
      <label>Fertilizers (‚Çπ)</label>
      <input type="number" id="fertilizers" oninput="calculateFinance()">
    </div>

    <div class="input-group">
      <label>Irrigation (‚Çπ)</label>
      <input type="number" id="irrigation" oninput="calculateFinance()">
    </div>

    <div class="input-group">
      <label>Labor (‚Çπ)</label>
      <input type="number" id="labor" oninput="calculateFinance()">
    </div>

    <div class="input-group">
      <label>Expected Yield (kg)</label>
      <input type="number" id="expectedYield" oninput="calculateFinance()">
    </div>

    <div class="input-group">
      <label>Actual Yield (kg)</label>
      <input type="number" id="actualYield" oninput="calculateFinance()">
    </div>

    <div class="input-group">
      <label>Selling Price (‚Çπ/kg)</label>
      <input type="number" id="price" oninput="calculateFinance()">
    </div>

    <div id="financeResult" class="result-box">Enter values to see results...</div>
  </div>

  <div class="nav-cards">
    <div class="nav-card" onclick="location.href='advisory.html'"><h3>Advisory</h3><p>View weather & farming tips</p></div>
    <div class="nav-card" onclick="location.href='irrigation.html'"><h3>Irrigation</h3><p>Monitor water systems</p></div>
    <div class="nav-card" onclick="location.href='knowledge.html'"><h3>Knowledge Hub</h3><p>Learn best practices</p></div>
  </div>
</div>

<script>
const apiKey = "867327a6239275c84a68a583e817e0b9";

function getSuggestion(desc){
  desc = desc.toLowerCase();
  if(desc.includes("rain")) return "üíß Rainy - check irrigation";
  if(desc.includes("clear") || desc.includes("sun")) return "‚òÄÔ∏è Clear - good for field work";
  if(desc.includes("cloud")) return "üå§Ô∏è Cloudy - monitor fields";
  if(desc.includes("storm") || desc.includes("thunder")) return "‚ö†Ô∏è Storm - secure equipment";
  if(desc.includes("snow")) return "‚ùÑÔ∏è Snow - protect sensitive crops";
  return "üå± Regular farm care";
}

function loadWeather(city=""){
  const url = `https://api.openweathermap.org/data/2.5/weather?q=${encodeURIComponent(city)}&appid=${apiKey}&units=metric`;
  fetch(url).then(res=>res.json()).then(data=>{
    const info = document.getElementById("weatherInfo");
    if(data.cod===200){
      const desc = data.weather[0].description;
      const suggestion = getSuggestion(desc);
      info.innerHTML = `
        üìç ${data.name}, ${data.sys.country}<br>
        üå°Ô∏è Temp: ${data.main.temp}¬∞C<br>
        üíß Humidity: ${data.main.humidity}%<br>
        üå¨Ô∏è Wind: ${data.wind.speed} m/s<br>
        üå± Suggestion: ${suggestion}
      `;
    } else { info.innerHTML = "‚ùå Weather data not available"; }
  }).catch(()=>{ document.getElementById("weatherInfo").innerHTML="‚ö†Ô∏è Error fetching weather"; });
}

function calculateFinance(){
  let seeds = +document.getElementById("seeds").value || 0;
  let fert = +document.getElementById("fertilizers").value || 0;
  let irr = +document.getElementById("irrigation").value || 0;
  let labor = +document.getElementById("labor").value || 0;
  let expYield = +document.getElementById("expectedYield").value || 0;
  let actYield = +document.getElementById("actualYield").value || 0;
  let price = +document.getElementById("price").value || 0;

  let totalExpense = seeds + fert + irr + labor;
  let expectedIncome = expYield * price;
  let actualIncome = actYield * price;
  let profitLoss = actualIncome - totalExpense;

  let result = `
    üí∏ <b>Total Expenses:</b> ‚Çπ${totalExpense}<br>
    üìà <b>Expected Income:</b> ‚Çπ${expectedIncome}<br>
    üìä <b>Actual Income:</b> ‚Çπ${actualIncome}<br>
    ${profitLoss >= 0 
      ? `‚úÖ <b>Profit:</b> ‚Çπ${profitLoss}` 
      : `‚ùå <b>Loss:</b> ‚Çπ${Math.abs(profitLoss)}`}
  `;

  document.getElementById("financeResult").innerHTML = result;
}

window.addEventListener("DOMContentLoaded", ()=>{
  const savedCity = localStorage.getItem("defaultCity") || "Hyderabad";
  loadWeather(savedCity);
});
</script>
</body>
</html>
